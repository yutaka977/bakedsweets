<h3>æ–°è¦æŠ•ç¨¿</h3>
<%= form_for @tweet do |f| %>
  <div class="field">
        <div class="actions">
    <%= f.label :body,"åº—å" %>
    <%= f.text_field :body,id:"outputBox" %>
    <%= f.label :lat,"ç·¯åº¦" %>
    <%= f.text_field :lat,:value =>"ç·¯åº¦", id: :lat %>
    <%= f.label :lng,"çµŒåº¦" %>
    <%= f.text_field :lng,:value =>"çµŒåº¦", id: :lng %>
  </div>
    <br>
    <%= f.label :ä¾¡æ ¼ %>
    <%= f.text_field :cost,size: 25 ,placeholder:"åŠè§’æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"%>
    <%= f.label :å†† %>
    <br>
    <%= f.label :ç¨®é¡ %> <%= f.collection_select(:type_id, Type.all, :id, :name, { prompt: 'é¸æŠã—ã¦ãã ã•ã„'}, { class: 'form-select'}) %>
    
 <div>

    <%= text_field_tag :new_type_name, nil, class: 'form-control',placeholder:"æ–°ã—ã„ç¨®é¡ã‚’è¿½åŠ " %>
    <font size="2"> â€» é¸æŠè‚¢ãŒãªã„å ´åˆã¯ã€ã“ã“ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ </font>
 </div>
    <br>
    <%= f.label :è©•ä¾¡ %>
    <br>
<div>
  <%= f.label :ç¾å‘³ã—ã• %>
  <br>
  1<%= f.range_field :taste, min: 1, max: 5,step: 0.5 ,value:3, id: 'range-taste' %>5
  <span id="current-value-taste"></span>
</div>

<div>
  <%= f.label :ä¾¡æ ¼ %>
  <br>
  1<%= f.range_field :evaluationcost,min: 1, max: 5,step: 0.5 ,value:3, id: 'range-evaluationcost' %>5
  <span id="current-value-evaluationcost"></span>
</div>

<div>
  <%= f.label :ã‚¢ã‚¯ã‚»ã‚¹ã®è‰¯ã• %>
  <br>
  1<%= f.range_field :access, min: 1, max: 5,step: 0.5 ,value:3, id: 'range-access' %>5
  <span id="current-value-access"></span>
</div>


              
    <br>
    <%= f.text_field :evaluation,size: 25 %>
  </div>
  <div class="field">
    <%= f.label :å†™çœŸ %>
    <%= f.file_field :images, multiple: true %>


  </div>


  <%= f.submit "æŠ•ç¨¿ã™ã‚‹" %>
<% end %>




<h2>Map</h2>
<input type="text" id="address" placeholder="ä½æ‰€ã‚’å…¥åŠ›">
<button type="button" id="search-address">ğŸ” ä½æ‰€æ¤œç´¢</button>

<!-- ç·¯åº¦ãƒ»çµŒåº¦ã‚’è‡ªå‹•å…¥åŠ›ã™ã‚‹ hidden input -->
<input type="hidden" id="lat" name="tweet[lat]">
<input type="hidden" id="lng" name="tweet[lng]">

<!-- Google Maps (newmapã‚¯ãƒ©ã‚¹) -->
<div class="newmap" data-lat="<%= @tweet.lat || 35.0223 %>" data-lng="<%= @tweet.lng || 135.9617 %>" style="height: 400px; width: 200px;"></div>


<script>
// âœ… ã™ã¹ã¦ã® JavaScript ã‚’ turbo:load ã§å®Ÿè¡Œ
document.addEventListener("turbo:load", function () {
  console.log("ğŸš€ Turbo Load: ã™ã¹ã¦ã® JavaScript åˆæœŸåŒ–é–‹å§‹");

  /** ğŸ—º Google Maps åˆæœŸåŒ– **/
  if (typeof google !== "undefined" && typeof google.maps !== "undefined") {
    console.log("âœ… Google Maps API ã¯ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿");
    if (typeof window.initMap === "function") {
      window.initMap();
    } else {
      console.error("âš ï¸ initMap é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼");
    }
  } else {
    console.warn("âš ï¸ Google Maps API ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒªãƒ­ãƒ¼ãƒ‰ãŒå¿…è¦ã‹ã‚‚");
  }

  /** ğŸ–¼ ç”»åƒåˆ‡ã‚Šæ›¿ãˆï¼ˆã‚µãƒ ãƒã‚¤ãƒ«ãƒ›ãƒãƒ¼ï¼‰ **/
  console.log("ğŸ–¼ ç”»åƒåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã®åˆæœŸåŒ–");

  const thumbnails = document.querySelectorAll(".thumbnail");
  const mainImage = document.getElementById("main-display");

  if (thumbnails.length > 0 && mainImage) {
    thumbnails.forEach((thumbnail) => {
      thumbnail.addEventListener("mouseover", function () {
        console.log("ğŸ–¼ ç”»åƒåˆ‡ã‚Šæ›¿ãˆ:", this.src);
        mainImage.src = this.src;
      });
    });
  } else {
    console.warn("âš ï¸ ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã¾ãŸã¯ãƒ¡ã‚¤ãƒ³ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
  }

  /** ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º **/
  console.log("ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å€¤ã®è¡¨ç¤ºã‚’åˆæœŸåŒ–");

  const fields = [
    { id: "range-taste", spanId: "current-value-taste" },
    { id: "range-evaluationcost", spanId: "current-value-evaluationcost" },
    { id: "range-access", spanId: "current-value-access" },
  ];

  fields.forEach(({ id, spanId }) => {
    const fieldElem = document.getElementById(id);
    const spanElem = document.getElementById(spanId);

    if (fieldElem && spanElem) {
      fieldElem.addEventListener("input", function () {
        spanElem.innerText = fieldElem.value;
      });

      spanElem.innerText = fieldElem.value;
    } else {
      console.warn(`âš ï¸ ${id} ã¾ãŸã¯ ${spanId} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
    }
  });

  /** ğŸ“ ä½ç½®æƒ…å ±å…¥åŠ›ã®åŒæœŸ **/
  console.log("ğŸ“ ä½ç½®æƒ…å ±å…¥åŠ›ã®åŒæœŸã‚’è¨­å®š");

  const inputBox = document.getElementById("address");
  const outputBox = document.getElementById("outputBox");

  if (inputBox && outputBox) {
    inputBox.addEventListener("input", function () {
      outputBox.value = inputBox.value;
    });
  } else {
    console.warn("âš ï¸ ä½ç½®æƒ…å ±ã®å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
  }
});

/** ğŸ—º Google Maps åˆæœŸåŒ– **/
function initMap() {
  console.log("ğŸ—º Google Maps åˆæœŸåŒ–");

  let mapElement = document.querySelector(".newmap"); // âœ… `id="map"` â†’ `class="newmap"`
  if (!mapElement) {
    console.error("âŒ åœ°å›³è¦ç´  (`.newmap`) ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
    return;
  }

  let lat = parseFloat(mapElement.dataset.lat) || 35.0223; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: æ»‹è³€çœŒè‰æ´¥å¸‚
  let lng = parseFloat(mapElement.dataset.lng) || 135.9617;

  let map = new google.maps.Map(mapElement, {
    center: { lat: lat, lng: lng },
    zoom: 15,
  });

  let marker = new google.maps.Marker({
    position: { lat: lat, lng: lng },
    map: map,
    draggable: true, // âœ… ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹
  });

  // ğŸ“ ãƒãƒ¼ã‚«ãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°ã§ç·¯åº¦ãƒ»çµŒåº¦ã‚’å–å¾—
  google.maps.event.addListener(marker, "dragend", function (event) {
    document.getElementById("lat").value = event.latLng.lat();
    document.getElementById("lng").value = event.latLng.lng();
  });

  // ğŸ“Œ ä½æ‰€æ¤œç´¢æ©Ÿèƒ½ã‚’è¿½åŠ 
  let geocoder = new google.maps.Geocoder();
  document.getElementById("search-address").addEventListener("click", function () {
    codeAddress(geocoder, map, marker);
  });
}

// âœ… `window.initMap` ã«ç™»éŒ²ï¼ˆGoogle API ã® `callback=initMap` ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ï¼‰
window.initMap = initMap;


function codeAddress(geocoder, map, marker) {
  let inputAddress = document.getElementById("address").value;

  if (!inputAddress) {
    alert("ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
    return;
  }

  geocoder.geocode({ address: inputAddress }, function (results, status) {
    if (status === "OK") {
      let location = results[0].geometry.location;
      map.setCenter(location);
      marker.setPosition(location);

      // ğŸ“ ç·¯åº¦çµŒåº¦ã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«è‡ªå‹•å…¥åŠ›
      document.getElementById("lat").value = location.lat();
      document.getElementById("lng").value = location.lng();

      console.log("âœ… ä½ç½®æƒ…å ±ç™»éŒ²æˆåŠŸ:", location.lat(), location.lng());
    } else {
      alert("ä½æ‰€ã®æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ: " + status);
      console.error("âŒ Google Maps Geocoding API ã‚¨ãƒ©ãƒ¼:", status);
    }
  });
}

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['YOUR_API_KEY'] %>&callback=initMap&libraries=places"></script>


<%= link_to "æŠ•ç¨¿ä¸€è¦§ã«æˆ»ã‚‹", tweets_path %>



